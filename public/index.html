<form id="pix-form">
  <input type="text" name="amount" id="amount" placeholder="Valor em R$" required />
  <button type="submit">Gerar Pix</button>
</form>

<div id="resultado"></div>

<script>
document.getElementById('pix-form').addEventListener('submit', async function(e) {
  e.preventDefault();

  const amount = document.getElementById('amount').value;

  const response = await fetch('/pix', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ amount })
  });

  const data = await response.json();

  if (data.qr_code) {
    document.getElementById('resultado').innerHTML = `
      <p><strong>Código Pix:</strong></p>
      <textarea id="codigo" rows="4" cols="60">${data.qr_code}</textarea>
      <br>
      <button onclick="copiarCodigo()">Copiar</button>
      <br><br>
      <img src="data:image/png;base64,${data.qr_code_image}" alt="QR Code">
    `;
  } else {
    document.getElementById('resultado').innerHTML = `<p style="color:red;">Erro: ${data.error?.message || 'Erro desconhecido'}</p>`;
  }
});

function copiarCodigo() {
  const texto = document.getElementById('codigo');
  texto.select();
  document.execCommand('copy');
  alert("Código Pix copiado!");
}
</script>
