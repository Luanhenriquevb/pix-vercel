<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <title>Gerar Pix BSPay</title>
  <style>
    body { font-family: Arial; max-width: 600px; margin: 30px auto; }
    label{ display:block;margin:8px 0 4px }
    input, textarea, button{ width:100%; padding:8px; box-sizing:border-box }
    button{ margin-top:15px; cursor:pointer }
    #result{ display:none; margin-top:25px }
  </style>
</head>
<body>
  <h1>QR Code Pix (BSPay)</h1>

  <form id="pixForm">
    <label>Nome</label>        <input name="name"      required>
    <label>CPF/CNPJ</label>    <input name="document"  required>
    <label>E-mail</label>      <input name="email" type="email">
    <label>Valor (R$)</label>  <input name="amount" type="number" step="0.01" min="0.01" required>
    <button>Gerar QR Code</button>
  </form>

  <div id="result">
    <h3>Código Pix</h3>
    <textarea id="pixCode" rows="4" readonly></textarea>
    <button id="copyBtn">Copiar</button>
  </div>

<script>
const form     = document.getElementById('pixForm');
const result   = document.getElementById('result');
const pixCode  = document.getElementById('pixCode');
const copyBtn  = document.getElementById('copyBtn');

form.addEventListener('submit', async e => {
  e.preventDefault();

  const data = {
    name     : form.name.value.trim(),
    document : form.document.value.trim(),
    email    : form.email.value.trim(),
    amount   : parseFloat(form.amount.value).toFixed(2)   // garante decimal
  };

  try {
    const r  = await fetch('/pix', {
      method : 'POST',
      headers: { 'Content-Type': 'application/json' },
      body   : JSON.stringify(data)
    });
    const j  = await r.json();

    if (!r.ok) return alert(j.error?.message || 'Erro desconhecido');

    pixCode.value = j.qr_code;
    result.style.display = 'block';
  } catch (err) {
    alert('Erro de rede: ' + err.message);
  }
});

copyBtn.onclick = () => {
  pixCode.select();
  document.execCommand('copy');
  alert('Código copiado!');
};
</script>
</body>
</html>
